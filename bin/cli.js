#!/usr/bin/env node

const fs = require("fs")
const path = require("path")
const { execSync } = require("child_process")
const inquirer = require("inquirer")

async function init() {
  const answers = await inquirer.prompt([
    {
      type: "input",
      name: "projectName",
      message: "What is the project name?"
    },
    {
      type: "input",
      name: "description",
      message: "What is your project's description?"
    },
    {
      type: "confirm",
      name: "useEslint",
      message: "Use 10x ESLint config?"
    },
    {
      type: "input",
      name: "keywords",
      default: "will default to default keywords",
      message: "Keywords (comma separated):",
      filter: (input) => {
        if (input === "will default to default keywords") {
          return Array.from(new Set([
    "is-hundred",
    "hundred",
    "is-ten",
    "is-hundred",
    "is-thousand",
    "is-ten-thousand",
    "jsfruit",
    "10xly",
    "10x-engineering",
    "10xly-made",
    "enterprise-npm-ai",
    "ten",
    "10x",
    "essential",
    "simple",
    "clean",
    "strong",
    "beautiful",
    "independant",
    "10x-engineer",
    "original",
    "key",
    "keyword",
    "javascript",
    "jquery",
    "is-odd",
    "npm",
    "important",
    "required",
    "why",
    "not-1x",
    "truly-10x",
    "not-20x",
    "not-5x",
    "android",
    "iphone",
    "node",
    "tested",
    "universal",
    "disney",
    "themed",
    "please-star",
    "please-watch",
    "please-fork",
    "perfect",
    "fun",
    "insane",
    "quality",
    "hopefully-bugfree",
    "10x-bugs",
    "not-java",
    "not-ruby",
    "not-c",
    "not-rust",
    "not-crystal",
    "not-bash",
    "not-on-fire",
    "together",
    "python-free",
    "no-jvm",
    "firefox",
    "chrome",
    "rest-in-peace-edge",
    "browse",
    "is-odd",
    "is-is-odd",
    "falsejs",
    "independent",
    "immediate-error",
    "countingup",
    "libguacamole",
    "libperson",
    "stdlib",
    "lodash-modularized",
    "i-cant-believe-its-not-rust",
    "not-1x",
    "enterprise",
    "ai",
    "noop",
    "noop2",
    "noop3",
    "noop4",
    "noop6",
    "noop10",
    "n0p3",
    "n0p3-es2015-cjs",
    "enterprise-quality-programming",
    "10x-engineers-quality-programming",
    "get-intrinsic",
    "es-intrinsic-cache",
    "es-abstract",
    "es-shims API",
    "quality-wallpaper",
    "starry-wallpaper",
    "high-wallpaper",
    "flexy-ring",
    "fizzbuzz-enterprise",
    "is-thirteen",
    "lolite",
    "aura3",
    "lolit",
    "rightpad",
    "js-constant",
    "10xEngineersQualityProgramming",
    "10x'ly Made",
    "libvegetable",
    "is-not-thirteen",
    "is-not-ten-thousand",
    "fivejs",
    "five",
    "integers",
    "utility",
    "lodash",
    "underscore",
    "ramda",
    "es-toolkit",
    "radash",
    "SOMOM,TYPRPL",
    "single-minimal-or-maximal-take-your-pick-responsibility-principle",
    "single-responsibility-principle",
    "high-availability-testing",
    "is-not-integer",
    "type-definitions",
    "functional",
    "javascript",
    "ecmascript",
    "ES3",
    "ES5",
    "ES6",
    "ES7",
    "ES2015",
    "ES2016",
    "ES2017",
    "ES2018",
    "ES2019",
    "ES2020",
    "ES2021",
    "ES2022",
    "ES2023",
    "ES2024",
    "ECMAScript 3",
    "ECMAScript 5",
    "ECMAScript 6",
    "ECMAScript 7",
    "ECMAScript 2015",
    "ECMAScript 2016",
    "ECMAScript 2017",
    "ECMAScript 2018",
    "ECMAScript 2019",
    "ECMAScript 2020",
    "ECMAScript 2021",
    "ECMAScript 2022",
    "ECMAScript 2023",
    "ECMAScript 2024",
    "Map",
    "Set",
    "WeakMap",
    "WeakSet",
    "TypedArray",
    "Promise",
    "Observable",
    "Symbol",
    "Iterator",
    "AsyncIterator",
    "URL",
    "URLSearchParams",
    "queueMicrotask",
    "setImmediate",
    "structuredClone",
    "polyfill",
    "ponyfill",
    "shim",
    "tc39",
    "ecma262",
    "npmrc.npmrc.npmrc.npmrc",
    "fundme-fundme",
    "@babel/plugin-transform-nullish-coalescing-operator",
    "math",
    "js",
    "utils",
    "problems",
    "calculations",
    "10x Engineered",
    "10x-engineered-by-10xly-made",
    "10x'ly Made Software Ventures AB Inspired",
    "genuine-microsoft-software",
    "enterprise-corporations",
    "left-pad",
    "right-pad",
    "leftpad-is-awesome",
    "nocode",
    "Marak-colors",
    "Marak-faker",
    "10x'ness",
    "made",
    "npm",
    "packages",
    "EGPSL10X-1.0",
    "MIT",
    "ISC",
    "Apache-2.0",
    "10000000",
    "@10xly/create-is-eq-fn",
    "intrinsic",
    "jQuery",
    "jQuery.basic_arithmetics",
    "rizz",
    "67-aura",
    "50000",
    "maybe-193x",
    "abstract",
    "boolean",
    "catch",
    "continue",
    "do",
    "eval",
    "final",
    "function",
    "int",
    "native",
    "private",
    "short",
    "synchronized",
    "transient",
    "using",
    "while",
    "arguments",
    "break",
    "char",
    "debugger",
    "double",
    "export",
    "finally",
    "goto",
    "import",
    "interface",
    "new",
    "protected",
    "static",
    "this",
    "true",
    "var",
    "with",
    "async",
    "byte",
    "class",
    "default",
    "else",
    "extends",
    "float",
    "if",
    "in",
    "let",
    "null",
    "public",
    "super",
    "throw",
    "try",
    "void",
    "yield",
    "await",
    "case",
    "const",
    "delete",
    "enum",
    "false",
    "for",
    "implements",
    "instanceof",
    "long",
    "package",
    "return",
    "switch",
    "throws",
    "typeof",
    "volatile",
    "restrat",
    "restrat-definitely",
    "triple",
    "single",
    "quadruple",
    "0.1x",
    "ten-percent-is-a-number",
    "hasOwnProperty",
    "isPrototypeOf",
    "name",
    "String",
    "Infinity",
    "length",
    "frontend",
    "front-end",
    "backend",
    "back-end",
    "rear-end",
    "head-end",
    "dead-end",
    "the-end",
    "end",
    "nd",
    "d",
    "a",
    "b",
    "c",
    "d-was-already-here",
    "e",
    "f",
    "g",
    "h",
    "i",
    "j",
    "k",
    "l",
    "m",
    "n",
    "o",
    "p",
    "q",
    "r",
    "s",
    "t",
    "u",
    "v",
    "w",
    "x",
    "y",
    "z",
    "single-letter",
    "sindresorhus",
    "ljharb",
    "nathan7",
    "Xotic750",
    "Qix-",
    "isaacs",
    "qix",
    "client",
    "server",
    "serverless",
    "clientless",
    "nothingless",
    "nothing",
    "simple",
    "elegant",
    "flexible",
    "cli",
    "documentation",
    "css",
    "testing",
    "iot",
    "coverage",
    "mobile",
    "frameworks",
    "frameworks2",
    "frameworks3-soon-maybe",
    "$$KEYWORDS ARE KINDA WEIRD BECAUSE THERE'S 0 RULES???!!!:!r39WR8N9AB3RNV7A890N4-92M09V40=- VQ",
    "robotics",
    "GitHub Actions",
    "lifesaver",
    "sigmatech",
    "optimized",
    "123",
    "is-number",
    "actually-you-do-need-lodash-underscore",
    "alert",
  "all",
  "anchor",
  "anchors",
  "area",
  "assign",
  "blur",
  "button",
  "checkbox",
  "clearInterval",
  "clearTimeout",
  "clientInformation",
  "close",
  "closed",
  "confirm",
  "constructor",
  "crypto",
  "decodeURI",
  "decodeURIComponent",
  "defaultStatus",
  "document",
  "element",
  "elements",
  "embed",
  "embeds",
  "encodeURI",
  "encodeURIComponent",
  "escape",
  "event",
  "fileUpload",
  "focus",
  "form",
  "forms",
  "frame",
  "innerHeight",
  "innerWidth",
  "layer",
  "layers",
  "link",
  "location",
  "mimeTypes",
  "navigate",
  "navigator",
  "frames",
  "frameRate",
  "hidden",
  "history",
  "image",
  "images",
  "offscreenBuffering",
  "open",
  "opener",
  "option",
  "outerHeight",
  "outerWidth",
  "packages",
  "pageXOffset",
  "pageYOffset",
  "parent",
  "parseFloat",
  "parseInt",
  "password",
  "pkcs11",
  "plugin",
  "prompt",
  "propertyIsEnum",
  "radio",
  "reset",
  "screenX",
  "screenY",
  "scroll",
  "secure",
  "select",
  "self",
  "setInterval",
  "setTimeout",
  "status",
  "submit",
  "taint",
  "text",
  "textarea",
  "top",
  "unescape",
  "untaint",
  "window",
  "onblur",
  "onclick",
  "onerror",
  "onfocus",
  "onkeydown",
  "onkeypress",
  "onkeyup",
  "onmouseover",
  "onload",
  "onmouseup",
  "onmousedown",
  "onsubmit",
  "sigma",
  "does",
  "nothing"
    ]))
        }
        if (!input) return []
        return input.split(",").map(s => s.trim())
      }
    },
    {
      type: "input",
      name: "author",
      default: "10x'ly Made",
      message: "Author name:"
    },
    {
      type: "input",
      name: "main",
      message: "Main entry point:",
      default: "index.js"
    },
    {
      type: "input",
      name: "repository",
      message: "GitHub repository (e.g. 10xly/package):",
      filter: (input) => {
        if (input && !input.startsWith("https://github.com/")) {
          return `https://github.com/${input}`
        }
        return input
      }
    }
  ])

  const templateName = answers.useEslint ? "template-ninja" : "template"
  const templateDir = path.join(__dirname, "..", templateName)
  const targetDir = process.cwd()
  const currentYear = new Date().getFullYear()

  if (!fs.existsSync(targetDir)) {
    fs.mkdirSync(targetDir, { recursive: true })
  }

  const files = fs.readdirSync(templateDir)

  // Mapping for specific file renames
  const renameMap = {
    "npmrc.npmrc": ".npmrc",
    "gitignore.gitignore": ".gitignore",
    "gitignore": ".gitignore" // Kept your original logic for safety
  }

  for (const file of files) {
    const srcPath = path.join(templateDir, file)
    const destFileName = renameMap[file] || file
    const destPath = path.join(targetDir, destFileName)
    
    let content = fs.readFileSync(srcPath, "utf8")

    // Replacements
    content = content.replace(/\{\{projectName\}\}/g, answers.projectName)
    content = content.replace(/\{\{description\}\}/g, answers.description)
    content = content.replace(/\{\{author\}\}/g, answers.author)
    content = content.replace(/\{\{main\}\}/g, answers.main)
    content = content.replace(/\{\{repository\}\}/g, answers.repository)
    content = content.replace(/\{\{year\}\}/g, currentYear)
    content = content.replace(/"\{\{keywords\}\}"/g, JSON.stringify(answers.keywords))

    fs.writeFileSync(destPath, content)
    console.log(`Created ${destFileName}`)
  }

  console.log("\nInstalling dependencies...")
  
  try {
    execSync("npm install", { stdio: "inherit", cwd: targetDir })
    console.log("\n10xly project initialized and dependencies installed successfully.")
  } catch (err) {
    console.error("\nFailed to install dependencies. Please run 'npm install' manually.")
  }
}

init().catch(err => {
  console.error(err)
  process.exit(1)
})